function filterGroupsFromSearchTerm(e,t){var n=new RegExp(t,"i");return _.filter(_.map(e,function(e){return{name:e.name,items:_.filter(e.items,function(e){return n.test(e.name)})}}),function(e){return e.items.length>0})}var defaultDropdownState={hoverId:null,searchTerm:"",open:!1,selectedId:null,items:[],groups:[]},Dropdown=React.createClass({displayName:"Dropdown",componentDidMount:function(){$(document).on("click",".dropdown",function(e){e.preventDefault(),e.stopPropagation()})},getInitialState:function(){return _.extend(defaultDropdownState,{groups:this.props.groups})},handleSelectedItemClick:function(e){e.preventDefault(),this.toggleDropbox()},handleSearchKeyUp:function(e,t){this.state.searchTerm!==t&&this.setState({searchTerm:t,hoverId:null})},handleSearchKeyDown:function(e){38==e.which?this.nextHoverIdUp():40==e.which?this.nextHoverIdDown():13==e.which&&this.selectFromEnterKey()},nextHoverIdUp:function(){var e=this.searchedItemsLength(),t=this.state.hoverId,n=0>t-1?e-1:t-1;this.setState({hoverId:n})},nextHoverIdDown:function(){var e=this.searchedItemsLength(),t=null==this.state.hoverId?-1:this.state.hoverId,n=t+1>e-1?0:t+1;this.setState({hoverId:n})},selectFromEnterKey:function(){var e=this,t=_.flatten(_.map(this.searchedGroups(),function(e){return e.items})),n=_.find(t,function(t,n){return n==e.state.hoverId});n&&this.handleSelectedItemChange($.Event("click"),{selectedId:n.id})},searchedGroups:function(){return filterGroupsFromSearchTerm(this.state.groups,this.state.searchTerm)},searchedItemsLength:function(){return _.reduce(_.map(this.searchedGroups(),function(e){return e.items.length}),function(e,t){return e+t})},handleSelectedItemChange:function(e,t){e.stopPropagation(),this.setState({selectedId:t.selectedId,open:!1,searchTerm:"",hoverId:null})},handleItemHoverChange:function(e){this.setState({hoverId:e})},toggleDropbox:function(){var e;e=this.state.open?{open:!1,searchTerm:"",hoverId:null}:{open:!0},this.setState(e)},dropdownBoxEl:function(e){return this.state.open===!0?DropdownBox({searchTerm:this.state.searchTerm,groups:e,handleSelectedItemChange:this.handleSelectedItemChange,open:this.state.open,toggleDropbox:this.toggleDropbox,hoverId:this.state.hoverId,handleItemHoverChange:this.handleItemHoverChange,handleSearchKeyUp:this.handleSearchKeyUp,handleSearchKeyDown:this.handleSearchKeyDown}):void 0},render:function(){var e=this.state.selectedId,t=_.flatten(_.map(this.state.groups,function(e){return e.items})),n=_.find(t,function(t){return e==t.id})||{id:null,name:"Select an Option"},o=this.searchedGroups();return React.DOM.div({className:"dropdown"},DropdownSelectedItem({name:n.name,handleSelectedItemClick:this.handleSelectedItemClick,toggleDropbox:this.toggleDropbox}),this.dropdownBoxEl(o))}}),DropdownBox=React.createClass({displayName:"DropdownBox",bodyClick:null,componentDidMount:function(){this.bodyClick=_.bind(this.handleBodyClick,this),this.props.open&&($("body").on("keydown",this.handleBodyKeydown),$(document).on("click",this.bodyClick))},componentWillUnmount:function(){$("body").off("keydown"),$(document).off("click",this.bodyClick)},componentDidUpdate:function(){if(this.props.open)$(this.refs.dropbox.getDOMNode()).show();else{var e=this;window.setTimeout(function(){$(e.refs.dropbox.getDOMNode()).hide()},500)}},handleBodyKeydown:function(e){27==e.which&&this.props.toggleDropbox()},handleBodyClick:function(){this.props.toggleDropbox()},render:function(){var e=this,t=-1;this.dropdownGroups=_.map(this.props.groups,function(n){var o=n.items,r=t;return t+=n.items.length,DropdownGroup({key:r,items:o,name:n.name,hoverId:e.props.hoverId,handleItemHoverChange:e.props.handleItemHoverChange,handleSelectedItemChange:e.props.handleSelectedItemChange})});var n="dropdownBox";return n+=this.props.open?" open":" close",React.DOM.div({className:n,ref:"dropbox"},DropdownSearch({open:this.props.open,searchTerm:this.props.searchTerm,handleSearchKeyDown:this.props.handleSearchKeyDown,handleSearchKeyUp:this.props.handleSearchKeyUp}),this.dropdownGroups)}}),DropdownGroup=React.createClass({displayName:"DropdownGroup",render:function(){var e=this.props.key,t=this;return this.items=_.map(this.props.items,function(n){return e++,DropdownItem({id:n.id,key:e,name:n.name,hoverId:t.props.hoverId,handleItemHoverChange:t.props.handleItemHoverChange,handleSelectedItemChange:t.props.handleSelectedItemChange})}),React.DOM.div({className:"dropdownGroup"},React.DOM.span(null,this.props.name),this.items)}}),DropdownItem=React.createClass({displayName:"DropdownItem",handleClick:function(e){this.props.handleSelectedItemChange(e,{selectedId:this.props.id})},handleMouseEnter:function(){this.props.handleItemHoverChange(this.props.key)},handleMouseLeave:function(){this.props.hoverId==this.props.key&&this.props.handleItemHoverChange(null)},render:function(){return className="dropdownItem",className+=this.props.hoverId==this.props.key?" hover":"",React.DOM.div({className:className,id:this.props.id,onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},this.props.name)}}),DropdownSearch=React.createClass({displayName:"DropdownSearch",componentDidMount:function(){this.props.open&&$(this.refs.input.getDOMNode()).val(this.props.searchTerm).focus()},handleKeyUp:function(e){var t=$.trim($(this.refs.input.getDOMNode()).val());this.props.handleSearchKeyUp(e,t)},render:function(){return React.DOM.div({className:"dropdownSearch"},React.DOM.input({ref:"input",onKeyUp:this.handleKeyUp,onKeyDown:this.props.handleSearchKeyDown}))}}),DropdownSelectedItem=React.createClass({displayName:"DropdownSelectedItem",render:function(){return React.DOM.div({className:"dropdownSelectedItem",onClick:this.props.handleSelectedItemClick},this.props.name)}});