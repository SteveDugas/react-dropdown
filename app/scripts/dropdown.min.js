function filterGroupsFromSearchTerm(e,t){var n=new RegExp(t,"i");return _.filter(_.map(e,function(e){return{name:e.name,items:_.filter(e.items,function(e){return n.test(e.name)})}}),function(e){return e.items.length>0})}function filterItemsFromSearchTerm(e,t){var n=new RegExp(t,"i");return _.filter(e,function(e){return n.test(e.name)})}var defaultDropdownState={hoverId:null,searchTerm:"",open:!1,selectedId:null},defaultDropdownProps={items:[],groups:[]},ReactCSSTransitionGroup=React.addons.CSSTransitionGroup,Dropdown=React.createClass({displayName:"Dropdown",bodyClick:null,componentDidMount:function(){$(document).on("click",".dropdown",function(e){e.preventDefault(),e.stopPropagation()}),this.bodyClick=_.bind(this.handleBodyClick,this)},componentDidUpdate:function(){this.state.open?($("body").on("keydown",this.handleBodyKeydown),$(document).on("click",this.bodyClick)):($("body").off("keydown"),$(document).off("click",this.bodyClick))},getInitialState:function(){return defaultDropdownState},getDefaultProps:function(){return defaultDropdownProps},handleSelectedItemClick:function(e){e.preventDefault(),this.toggleDropbox()},handleBodyKeydown:function(e){27==e.which&&this.toggleDropbox()},handleBodyClick:function(){this.toggleDropbox()},handleSearchKeyUp:function(e,t){this.state.searchTerm!==t&&this.setState({searchTerm:t,hoverId:null})},handleSearchKeyDown:function(e){38==e.which?this.nextHoverIdUp():40==e.which?this.nextHoverIdDown():13==e.which&&this.selectFromEnterKey()},nextHoverIdUp:function(){var e=this.searchedAllLength(),t=this.state.hoverId,n=0>t-1?e-1:t-1;this.setState({hoverId:n})},nextHoverIdDown:function(){var e=this.searchedAllLength(),t=null==this.state.hoverId?-1:this.state.hoverId,n=t+1>e-1?0:t+1;this.setState({hoverId:n})},selectFromEnterKey:function(){var e=this.searchedAll(),t=_.find(e,function(e,t){return t==this.state.hoverId},this);t&&this.handleSelectedItemChange($.Event("click"),{selectedId:t.id})},searchedGroups:function(){return filterGroupsFromSearchTerm(this.props.groups,this.state.searchTerm)},searchedItems:function(){return filterItemsFromSearchTerm(this.props.items,this.state.searchTerm)},searchedAll:function(){var e=this.searchedItems(),t=_.flatten(_.map(this.searchedGroups(),function(e){return e.items}));return e.concat(t)},searchedAllLength:function(){return this.searchedAll().length},handleSelectedItemChange:function(e,t){e.stopPropagation(),this.setState({selectedId:t.selectedId,open:!1,searchTerm:"",hoverId:null}),$(this).trigger("change",{selected:t.selectedId})},handleItemHoverChange:function(e){this.setState({hoverId:e})},toggleDropbox:function(){var e;e=this.state.open?{open:!1,searchTerm:"",hoverId:null}:{open:!0},this.setState(e)},dropdownBoxEl:function(){var e=this.searchedGroups(),t=this.searchedItems();return this.state.open===!0?DropdownBox({key:1,searchTerm:this.state.searchTerm,groups:e,items:t,handleSelectedItemChange:this.handleSelectedItemChange,open:this.state.open,toggleDropbox:this.toggleDropbox,hoverId:this.state.hoverId,handleItemHoverChange:this.handleItemHoverChange,handleSearchKeyUp:this.handleSearchKeyUp,handleSearchKeyDown:this.handleSearchKeyDown}):void 0},allItems:function(){var e=_.flatten(_.map(this.props.groups,function(e){return e.items}));return this.props.items.concat(e)},render:function(){var e=this.state.selectedId,t=_.find(this.allItems(),function(t){return e==t.id})||{id:null,name:"Select an Option"};return ReactCSSTransitionGroup({className:"dropdown",transitionName:"dropdownBox",component:React.DOM.div},DropdownSelectedItem({key:2,name:t.name,handleSelectedItemClick:this.handleSelectedItemClick,toggleDropbox:this.toggleDropbox}),this.dropdownBoxEl())}}),DropdownBox=React.createClass({displayName:"DropdownBox",render:function(){var e=-1;return this.dropdownItems=_.map(this.props.items,function(t){return e++,DropdownItem({id:t.id,key:e,name:t.name,hoverId:this.props.hoverId,handleItemHoverChange:this.props.handleItemHoverChange,handleSelectedItemChange:this.props.handleSelectedItemChange})},this),this.dropdownGroups=_.map(this.props.groups,function(t){var n=t.items,o=e;return e+=t.items.length,DropdownGroup({key:o,items:n,name:t.name,hoverId:this.props.hoverId,handleItemHoverChange:this.props.handleItemHoverChange,handleSelectedItemChange:this.props.handleSelectedItemChange})},this),React.DOM.div({className:"dropdownBox",ref:"dropbox"},DropdownSearch({searchTerm:this.props.searchTerm,handleSearchKeyDown:this.props.handleSearchKeyDown,handleSearchKeyUp:this.props.handleSearchKeyUp}),this.dropdownItems,this.dropdownGroups)}}),DropdownGroup=React.createClass({displayName:"DropdownGroup",render:function(){var e=this.props.key;return this.items=_.map(this.props.items,function(t){return e++,DropdownItem({id:t.id,key:e,name:t.name,hoverId:this.props.hoverId,handleItemHoverChange:this.props.handleItemHoverChange,handleSelectedItemChange:this.props.handleSelectedItemChange})},this),React.DOM.div({className:"dropdownGroup"},React.DOM.span(null,this.props.name),this.items)}}),DropdownItem=React.createClass({displayName:"DropdownItem",handleClick:function(e){this.props.handleSelectedItemChange(e,{selectedId:this.props.id})},handleMouseEnter:function(){this.props.handleItemHoverChange(this.props.key)},handleMouseLeave:function(){this.props.hoverId==this.props.key&&this.props.handleItemHoverChange(null)},render:function(){return className="dropdownItem",className+=this.props.hoverId==this.props.key?" hover":"",React.DOM.div({className:className,id:this.props.id,onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},this.props.name)}}),DropdownSearch=React.createClass({displayName:"DropdownSearch",componentDidMount:function(){$(this.refs.input.getDOMNode()).val(this.props.searchTerm).focus()},handleKeyUp:function(e){var t=$.trim($(this.refs.input.getDOMNode()).val());this.props.handleSearchKeyUp(e,t)},render:function(){return React.DOM.div({className:"dropdownSearch"},React.DOM.input({ref:"input",onKeyUp:this.handleKeyUp,onKeyDown:this.props.handleSearchKeyDown}))}}),DropdownSelectedItem=React.createClass({displayName:"DropdownSelectedItem",render:function(){return React.DOM.div({className:"dropdownSelectedItem"},React.DOM.input({value:this.props.name,readonly:!0,onClick:this.props.handleSelectedItemClick}))}});