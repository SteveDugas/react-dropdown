function filterGroupsFromSearchTerm(e,t){var o=new RegExp(t,"i");return _.filter(_.map(e,function(e){return{name:e.name,items:_.filter(e.items,function(e){return o.test(e.name)})}}),function(e){return e.items.length>0})}var defaultDropdownState={hoverId:null,searchTerm:"",open:!1,selectedId:null,items:[],groups:[]},Dropdown=React.createClass({displayName:"Dropdown",componentDidMount:function(){$(document).on("click",".dropdown",function(e){e.preventDefault(),e.stopPropagation()})},getInitialState:function(){return _.extend(defaultDropdownState,{groups:this.props.groups})},handleSelectChange:function(e){this.updateState({selectedId:e,open:!1,searchTerm:"",hoverId:null})},updateState:function(e){this.setState(_.extend(this.state,e))},toggleDropbox:function(){var e;e=this.state.open?{open:!1,searchTerm:"",hoverId:null}:{open:!0},this.updateState(e)},dropdownBoxEl:function(){return this.state.open===!0?DropdownBox({searchTerm:this.state.searchTerm,items:this.searchedGroups,onSelectedChange:this.handleSelectChange,open:this.state.open,toggleDropbox:this.toggleDropbox,updateState:this.updateState,hoverId:this.state.hoverId}):void 0},render:function(){var e=this.state.selectedId,t=_.flatten(_.map(this.state.groups,function(e){return e.items})),o=_.find(t,function(t){return e==t.id})||{id:null,name:"Select an Option"};return this.searchedGroups=filterGroupsFromSearchTerm(this.state.groups,this.state.searchTerm),React.DOM.div({className:"dropdown"},DropdownSelectedItem({id:o.id,name:o.name,toggleDropbox:this.toggleDropbox}),this.dropdownBoxEl())}}),DropdownSelectedItem=React.createClass({displayName:"DropdownSelectedItem",handleClick:function(){this.props.toggleDropbox()},render:function(){return React.DOM.div({className:"dropdownSelectedItem",id:this.props.id,onClick:this.handleClick},this.props.name)}}),DropdownBox=React.createClass({displayName:"DropdownBox",bodyClick:null,componentDidMount:function(){this.bodyClick=_.bind(this.handleBodyClick,this),this.props.open&&($("body").on("keydown",this.handleBodyKeydown),$(document).on("click",this.bodyClick))},componentWillUnmount:function(){$("body").off("keydown"),$(document).off("click",this.bodyClick)},componentDidUpdate:function(){if(this.props.open)$(this.refs.dropbox.getDOMNode()).show();else{var e=this;window.setTimeout(function(){$(e.refs.dropbox.getDOMNode()).hide()},500)}},handleBodyKeydown:function(e){27==e.which&&this.props.toggleDropbox()},handleBodyClick:function(){this.props.toggleDropbox()},moveHoverItem:function(e){var t=_.reduce(_.map(this.props.items,function(e){return e.items.length}),function(e,t){return e+t}),o=null;"down"==e?o=null!==this.props.hoverId?this.props.hoverId+1>t-1?0:this.props.hoverId+1:0:"up"==e&&(o=this.props.hoverId-1<0?t-1:this.props.hoverId-1),null!==o&&this.props.updateState({hoverId:o})},selectFromHover:function(){var e=this,t=_.flatten(_.map(this.props.items,function(e){return e.items})),o=_.find(t,function(t,o){return o==e.props.hoverId});o&&this.props.onSelectedChange(o.id)},render:function(){var e=this,t=-1;this.dropdownGroups=_.map(this.props.items,function(o){var n=o.items,r=t;return t+=o.items.length,DropdownGroup({key:r,items:n,name:o.name,hoverId:e.props.hoverId,updateState:e.props.updateState,onSelectedChange:e.props.onSelectedChange})});var o="dropdownBox ";return o+=this.props.open?"open":"close",React.DOM.div({className:o,ref:"dropbox"},DropdownSearch({open:this.props.open,updateState:this.props.updateState,selectFromHover:this.selectFromHover,moveHoverItem:this.moveHoverItem,searchTerm:this.props.searchTerm}),this.dropdownGroups)}}),DropdownGroup=React.createClass({displayName:"DropdownGroup",getItems:function(){return this.items},render:function(){var e=this.props.key,t=this;return this.items=_.map(this.props.items,function(o){return e++,DropdownItem({id:o.id,key:e,name:o.name,hoverId:t.props.hoverId,updateState:t.props.updateState,onSelectedChange:t.props.onSelectedChange})}),React.DOM.div({className:"dropdownGroup"},React.DOM.span(null,this.props.name),this.items)}}),DropdownItem=React.createClass({displayName:"DropdownItem",handleClick:function(e){this.props.onSelectedChange(this.props.id),e.stopPropagation()},handleMouseEnter:function(){this.props.updateState({hoverId:this.props.key})},handleMouseLeave:function(){this.props.hoverId==this.props.key&&this.props.updateState({hoverId:null})},render:function(){return className=this.props.hoverId==this.props.key?"dropdownItem hover":"dropdownItem",React.DOM.div({className:className,id:this.props.id,onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},this.props.name)}}),DropdownSearch=React.createClass({displayName:"DropdownSearch",componentDidMount:function(){this.props.open&&$(this.refs.input.getDOMNode()).val(this.props.searchTerm).focus()},handleKeyUp:function(){var e=$.trim($(this.refs.input.getDOMNode()).val());this.props.searchTerm!==$.trim(e)&&this.props.updateState({searchTerm:e,hoverId:null})},handleKeyDown:function(e){38==e.which?this.props.moveHoverItem("up"):40==e.which?this.props.moveHoverItem("down"):13==e.which&&this.props.selectFromHover()},render:function(){return React.DOM.div({className:"dropdownSearch"},React.DOM.input({ref:"input",onKeyUp:this.handleKeyUp,onKeyDown:this.handleKeyDown,updateFromKey:this.props.selectFromHover}))}});