function filterGroupsFromSearchTerm(e,t){var o=new RegExp(t,"i");return _.filter(_.map(e,function(e){return{name:e.name,items:_.filter(e.items,function(e){return o.test(e.name)})}}),function(e){return e.items.length>0})}var defaultDropdownState={hoverId:null,searchTerm:"",open:!1,selectedId:null,items:[],groups:[]},Dropdown=React.createClass({displayName:"Dropdown",componentDidMount:function(){$(document).on("click",".dropdown",function(e){e.preventDefault(),e.stopPropagation()})},getInitialState:function(){return _.extend(defaultDropdownState,{groups:this.props.groups})},handleSearchKeyUp:function(){},handleSearchKeyDown:function(e){38==e.which?this.nextHoverIdUp():40==e.which?this.nextHoverIdDown():13==e.which&&this.selectFromEnterKey()},searchedGroups:function(){return filterGroupsFromSearchTerm(this.state.groups,this.state.searchTerm)},searchedItemsLength:function(){return _.reduce(_.map(this.searchedGroups(),function(e){return e.items.length}),function(e,t){return e+t})},nextHoverIdUp:function(){var e=this.searchedItemsLength(),t=this.state.hoverId,o=0>t-1?e-1:t-1;this.setState({hoverId:o})},nextHoverIdDown:function(){var e=this.searchedItemsLength(),t=null==this.state.hoverId?-1:this.state.hoverId,o=t+1>e-1?0:t+1;this.setState({hoverId:o})},selectFromEnterKey:function(){var e=this,t=_.flatten(_.map(this.searchedGroups(),function(e){return e.items})),o=_.find(t,function(t,o){return o==e.state.hoverId});o&&this.handleSelectChange(o.id)},handleSelectChange:function(e){this.setState({selectedId:e,open:!1,searchTerm:"",hoverId:null})},handleSelectedItemChange:function(e,t){this.setState({selectedId:t.selectedId,open:!1,searchTerm:"",hoverId:null})},updateState:function(e){this.setState(_.extend(this.state,e))},updateHoverId:function(e){this.setState({hoverId:e})},updateSearchTerm:function(e){this.setState({searchTerm:e,hoverId:null})},toggleDropbox:function(){var e;e=this.state.open?{open:!1,searchTerm:"",hoverId:null}:{open:!0},this.setState(e)},dropdownBoxEl:function(e){return this.state.open===!0?DropdownBox({searchTerm:this.state.searchTerm,groups:e,handleSelectChange:this.handleSelectChange,handleSelectedItemChange:this.handleSelectedItemChange,open:this.state.open,toggleDropbox:this.toggleDropbox,updateState:this.updateState,updateSearchTerm:this.updateSearchTerm,updateHoverId:this.updateHoverId,hoverId:this.state.hoverId,handleSearchKeyDown:this.handleSearchKeyDown}):void 0},render:function(){var e=this.state.selectedId,t=_.flatten(_.map(this.state.groups,function(e){return e.items})),o=_.find(t,function(t){return e==t.id})||{id:null,name:"Select an Option"},n=filterGroupsFromSearchTerm(this.state.groups,this.state.searchTerm);return React.DOM.div({className:"dropdown"},DropdownSelectedItem({id:o.id,name:o.name,toggleDropbox:this.toggleDropbox}),this.dropdownBoxEl(n))}}),DropdownSelectedItem=React.createClass({displayName:"DropdownSelectedItem",handleClick:function(){this.props.toggleDropbox()},render:function(){return React.DOM.div({className:"dropdownSelectedItem",id:this.props.id,onClick:this.handleClick},this.props.name)}}),DropdownBox=React.createClass({displayName:"DropdownBox",bodyClick:null,componentDidMount:function(){this.bodyClick=_.bind(this.handleBodyClick,this),this.props.open&&($("body").on("keydown",this.handleBodyKeydown),$(document).on("click",this.bodyClick))},componentWillUnmount:function(){$("body").off("keydown"),$(document).off("click",this.bodyClick)},componentDidUpdate:function(){if(this.props.open)$(this.refs.dropbox.getDOMNode()).show();else{var e=this;window.setTimeout(function(){$(e.refs.dropbox.getDOMNode()).hide()},500)}},handleBodyKeydown:function(e){27==e.which&&this.props.toggleDropbox()},handleBodyClick:function(){this.props.toggleDropbox()},render:function(){var e=this,t=-1;this.dropdownGroups=_.map(this.props.groups,function(o){var n=o.items,r=t;return t+=o.items.length,DropdownGroup({key:r,items:n,name:o.name,hoverId:e.props.hoverId,updateState:e.props.updateState,handleSelectedItemChange:e.props.handleSelectedItemChange,handleSelectChange:e.props.handleSelectChange})});var o="dropdownBox ";return o+=this.props.open?"open":"close",React.DOM.div({className:o,ref:"dropbox"},DropdownSearch({open:this.props.open,updateState:this.props.updateState,handleSearchKeyDown:this.props.handleSearchKeyDown,searchTerm:this.props.searchTerm}),this.dropdownGroups)}}),DropdownGroup=React.createClass({displayName:"DropdownGroup",render:function(){var e=this.props.key,t=this;return this.items=_.map(this.props.items,function(o){return e++,DropdownItem({id:o.id,key:e,name:o.name,hoverId:t.props.hoverId,updateState:t.props.updateState,handleSelectedItemChange:t.props.handleSelectedItemChange,handleSelectChange:t.props.handleSelectChange})}),React.DOM.div({className:"dropdownGroup"},React.DOM.span(null,this.props.name),this.items)}}),DropdownItem=React.createClass({displayName:"DropdownItem",handleClick:function(e){this.props.handleSelectChange(this.props.id),e.stopPropagation()},handleMouseEnter:function(){this.props.updateState({hoverId:this.props.key})},handleMouseLeave:function(){this.props.hoverId==this.props.key&&this.props.updateState({hoverId:null})},render:function(){return className=this.props.hoverId==this.props.key?"dropdownItem hover":"dropdownItem",React.DOM.div({className:className,id:this.props.id,onClick:this.handleClick,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},this.props.name)}}),DropdownSearch=React.createClass({displayName:"DropdownSearch",componentDidMount:function(){this.props.open&&$(this.refs.input.getDOMNode()).val(this.props.searchTerm).focus()},handleKeyUp:function(){var e=$.trim($(this.refs.input.getDOMNode()).val());this.props.searchTerm!==$.trim(e)&&this.props.updateState({searchTerm:e,hoverId:null})},render:function(){return React.DOM.div({className:"dropdownSearch"},React.DOM.input({ref:"input",onKeyUp:this.handleKeyUp,onKeyDown:this.props.handleSearchKeyDown}))}});